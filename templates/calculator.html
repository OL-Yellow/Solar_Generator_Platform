{% extends "layout.html" %}

{% block content %}
<div class="container py-4">
    <!-- Progress Bar -->
    <div class="progress mb-4">
        <div class="progress-bar" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
    </div>

    <!-- Calculator Form -->
    <form id="calculator-form" class="needs-validation" novalidate>
        <!-- Step 1: User Type and Location -->
        <div id="step1" class="step-container">
            <h3 class="mb-4">Basic Information</h3>
            <div class="mb-3">
                <label for="user-type" class="form-label">User Type</label>
                <select class="form-select" id="user-type" required>
                    <option value="household" selected>Household</option>
                    <option value="business">Business</option>
                </select>
                <div class="invalid-feedback">Please select a user type.</div>
            </div>
            <div class="mb-3">
                <label for="location" class="form-label">Location</label>
                <select class="form-select" id="location" required>
                    {% for location, hours in locations.items() %}
                    <option value="{{ hours }}" {% if location == "Lagos" %}selected{% endif %}>{{ location }}</option>
                    {% endfor %}
                </select>
                <div class="invalid-feedback">Please select your location.</div>
            </div>
            <input type="hidden" id="sun-hours" value="">
            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-solar btn-next">Next <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- Step 2: Generator Usage -->
        <div id="step2" class="step-container d-none">
            <h3 class="mb-4">Current Generator Usage</h3>
            <div class="mb-3">
                <label for="generator-size" class="form-label">Generator Size (kW)</label>
                <select class="form-select" id="generator-size" required>
                    <option value="2.5" selected>2.5 kW (Small Home)</option>
                    <option value="4">4.0 kW (Medium Home)</option>
                    <option value="6.5">6.5 kW (Large Home)</option>
                    <option value="10">10 kW (Small Business)</option>
                    <option value="15">15 kW (Medium Business)</option>
                    <option value="20">20 kW (Large Business)</option>
                </select>
                <div class="invalid-feedback">Please select your generator size.</div>
            </div>
            <div class="mb-3">
                <label for="generator-fuel" class="form-label">Monthly Fuel Consumption (Liters)</label>
                <input type="number" class="form-control" id="generator-fuel" value="100" required min="0">
                <div class="invalid-feedback">Please enter fuel consumption.</div>
            </div>
            <div class="mb-3">
                <label for="generator-maintenance" class="form-label">Annual Maintenance Cost (NGN)</label>
                <input type="number" class="form-control" id="generator-maintenance" value="50000" required min="0">
                <div class="invalid-feedback">Please enter maintenance cost.</div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-prev"><i class="fas fa-arrow-left"></i> Previous</button>
                <button type="button" class="btn btn-solar btn-next">Next <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- Step 3: Appliances -->
        <div id="step3" class="step-container d-none">
            <h3 class="mb-4">Appliances & Equipment</h3>

            <div class="appliance-list">
                <!-- No pre-filled appliance items -->
                <button type="button" class="btn btn-outline-light mt-3 w-100" onclick="addApplianceRow()">
                    <i class="fas fa-plus me-2"></i>Add Appliance
                </button>
                <div class="total-power mt-4 text-end">
                    <strong>Total Daily Power:</strong>
                    <span id="total-daily-power">13.40</span> kWh
                </div>

            </div>

            <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-secondary btn-prev">
                    <i class="fas fa-arrow-left me-2"></i>Previous
                </button>
                <button type="button" class="btn btn-solar btn-next">
                    Next<i class="fas fa-arrow-right ms-2"></i>
                </button>
            </div>
        </div>

        <!-- Step 4: Budget and Backup -->
        <div id="step4" class="step-container d-none">
            <h3 class="mb-4">Budget & Backup Requirements</h3>
            <div class="mb-3">
                <label for="budget-range" class="form-label">Budget Range (NGN)</label>
                <select class="form-select" id="budget-range" required>
                    <option value="500000-1000000">500,000 - 1,000,000</option>
                    <option value="1000000-2000000" selected>1,000,000 - 2,000,000</option>
                    <option value="2000000-5000000">2,000,000 - 5,000,000</option>
                    <option value="5000000+">5,000,000+</option>
                </select>
                <div class="invalid-feedback">Please select your budget range.</div>
            </div>
            <div class="mb-3">
                <label for="backup-days" class="form-label">Desired Backup Days</label>
                <input type="number" class="form-control" id="backup-days" value="2" min="1" max="7" required>
                <div class="invalid-feedback">Please enter desired backup days (1-7).</div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-prev"><i class="fas fa-arrow-left"></i> Previous</button>
                <button type="button" class="btn btn-solar" id="calculate-btn">Calculate Results</button>
            </div>
        </div>

        <!-- Step 5: Results -->
        <div id="step5" class="step-container d-none">
            <h3 class="mb-4">Your Solar Solution</h3>
            <div id="results-section" class="mt-5">
                <div class="results-card">
                    <h3 class="mb-4">Your Solar Solution</h3>
                    <div class="row g-4">
                        <div class="col-md-6">
                            <h5>System Requirements</h5>
                            <p>Solar Panel Size: <span id="system-size" class="value-highlight">0</span> kW</p>
                            <p>Battery Capacity: <span id="battery-size" class="value-highlight">0</span> kWh</p>
                        </div>
                        <div class="col-md-6">
                            <h5>Financial Analysis</h5>
                            <p>Total System Cost: ₦<span id="total-cost" class="value-highlight">0</span></p>
                            <p>Current Monthly Cost: ₦<span id="current-cost" class="value-highlight">0</span></p>
                            <p>Monthly Savings: ₦<span id="monthly-savings" class="value-highlight">0</span></p>
                            <p>Payback Period: <span id="payback-period" class="value-highlight">0</span> years</p>
                        </div>
                    </div>
                </div>

                <!-- ROI Chart -->
                <div class="chart-container">
                    <canvas id="roi-chart"></canvas>
                </div>

                <!-- Lead Capture Form -->
                <div class="results-card">
                    <h3 class="mb-4">Get Detailed Quote</h3>
                    <form action="{{ url_for('submit_lead') }}" method="POST" class="needs-validation" novalidate>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                                <div class="invalid-feedback">Please enter your name.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" name="phone" required>
                                <div class="invalid-feedback">Please enter a valid phone number.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                                <div class="invalid-feedback">Please enter a valid email address.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="contact-time" class="form-label">Best Time to Contact</label>
                                <select class="form-select" id="contact-time" name="contact_time" required>
                                    <option value="">Choose time...</option>
                                    <option value="morning">Morning (9AM - 12PM)</option>
                                    <option value="afternoon">Afternoon (12PM - 4PM)</option>
                                    <option value="evening">Evening (4PM - 7PM)</option>
                                    <option value="afternoon" selected>Afternoon (12PM - 4PM)</option>
                                </select>
                                <div class="invalid-feedback">Please select a contact time.</div>
                            </div>
                        </div>
                        <input type="hidden" id="lead-system-size" name="system_size">
                        <input type="hidden" id="lead-estimated-savings" name="estimated_savings">
                        <button type="submit" class="btn btn-solar mt-4">Get Quote</button>
                    </form>
                </div>
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-secondary btn-prev">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
            </div>
        </div>
    </form>
</div>

<script src="{{ url_for('static', filename='js/calculator.js') }}"></script>
{% endblock %}