<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Energy Calculator - Nigeria</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <h1 class="mb-4">Solar System Sizing Calculator</h1>
        
        <form id="calculatorForm" method="POST" action="{{ url_for('calculator.calculate') }}" class="needs-validation" novalidate>
            <div class="row g-3">
                <div class="col-md-6">
                    <h3>Location Information</h3>
                    <div class="mb-3">
                        <label for="city" class="form-label">City</label>
                        <input type="text" class="form-control" id="city" name="city" required>
                    </div>
                    <div class="mb-3">
                        <label for="state" class="form-label">State</label>
                        <input type="text" class="form-control" id="state" name="state" required>
                    </div>
                    <div class="mb-3">
                        <label for="location_temperature" class="form-label">Average Temperature (°C)</label>
                        <input type="number" class="form-control" id="location_temperature" name="location_temperature" required>
                    </div>
                </div>

                <div class="col-md-6">
                    <h3>Power Requirements</h3>
                    <div class="mb-3">
                        <label for="daily_energy_kwh" class="form-label">Daily Energy Usage (kWh)</label>
                        <input type="number" step="0.1" class="form-control" id="daily_energy_kwh" name="daily_energy_kwh" required>
                    </div>
                    <div class="mb-3">
                        <label for="peak_load_kw" class="form-label">Peak Load (kW)</label>
                        <input type="number" step="0.1" class="form-control" id="peak_load_kw" name="peak_load_kw" required>
                    </div>
                    <div class="mb-3">
                        <label for="grid_hours" class="form-label">Grid Availability (hours/day)</label>
                        <input type="number" step="0.5" class="form-control" id="grid_hours" name="grid_hours" required>
                    </div>
                </div>

                <div class="col-12">
                    <h3>System Requirements</h3>
                    <div class="mb-3">
                        <label for="backup_hours" class="form-label">Required Backup Hours</label>
                        <input type="number" step="0.5" class="form-control" id="backup_hours" name="backup_hours" required>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="has_voltage_issues" name="has_voltage_issues">
                        <label class="form-check-label" for="has_voltage_issues">Experience Voltage Issues?</label>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="has_motor_loads" name="has_motor_loads">
                        <label class="form-check-label" for="has_motor_loads">Have Motor Loads?</label>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="has_dual_use" name="has_dual_use">
                        <label class="form-check-label" for="has_dual_use">Dual Use (Home & Business)?</label>
                    </div>
                    <div class="mb-3">
                        <label for="budget_constraint" class="form-label">Budget Constraint (Optional)</label>
                        <input type="number" step="1000" class="form-control" id="budget_constraint" name="budget_constraint">
                    </div>
                </div>

                <div class="col-12">
                    <button type="submit" class="btn btn-primary">Calculate System Requirements</button>
                </div>
            </div>
        </form>

        <div id="results" class="mt-4"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('calculatorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch("{{ url_for('calculator.calculate') }}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                const resultsDiv = document.getElementById('results');
                
                if (response.ok) {
                    resultsDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h4>System Recommendations</h4>
                            <p>System Type: ${result.system_type}</p>
                            <p>Solar Capacity: ${result.system_size.solar_capacity_kw.toFixed(2)} kW</p>
                            <p>Battery Capacity: ${result.battery_size.capacity_kwh.toFixed(2)} kWh</p>
                            <p>Inverter Size: ${result.inverter_size.size_kw.toFixed(2)} kW</p>
                            <p>Initial Cost: ₦${result.economic_analysis.initial_cost.toLocaleString()}</p>
                            <p>Monthly Savings: ₦${result.economic_analysis.monthly_savings.toLocaleString()}</p>
                            <p>Payback Period: ${Math.round(result.economic_analysis.payback_period_months)} months</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="alert alert-danger">
                            Error: ${result.error}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('results').innerHTML = `
                    <div class="alert alert-danger">
                        An error occurred while processing your request.
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
